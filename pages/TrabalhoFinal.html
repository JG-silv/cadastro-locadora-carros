<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Locadora - Cadastro</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/styles.css">
<meta name="author" content="José">
</head>

<body>
  <div class="container">
    <center><img src="Images/logo.jpg" alt="Logo" style="width: 220px; border-radius: 20px;"></center>
    <h1>Cadastro Locação</h1>

    <div class="barra">
      <div class="barra-preenchida" id="barra"></div>
    </div>
    <!--Parte de Cadastro do Usuário-->
    <div class="input-row">
      <input type="text" id="nome" placeholder="Nome do Locador" onblur="formatarName(this)"
        onchange="atualizarBarra()" />
      <input type="text" id="cpf" placeholder="CPF" onblur="formatarCPF(this)" maxlength="14"
        onchange="atualizarBarra()" />
    </div>

    <div class="input-row">

      <input type="text" id="father" placeholder="Nome do Pai" onblur="formatarName(this)"
        onchange="atualizarBarra()" />
      <input type="text" id="mom" placeholder="Nome da Mãe" onblur="formatarName(this)" onchange="atualizarBarra()" />
    </div>

    <div class="input-row"><!--Placa e Seguro do Veiculo-->
      <input type="text" id="placa" placeholder="Placa do Veículo" onblur="formatarPlaca(this)" maxlength="7"
        onchange="atualizarBarra()" />
      <select id="cor" onchange="atualizarBarra()">
        <option value="">Seguro do Veículo</option>
        <option>Básico</option>
        <option>Intermediário</option>
        <option>Completo</option>
        <option>Premium</option>
      </select>
    </div>

    <div class="input-row"><!--Categorias do Carro-->
      <select id="categoria" onchange="atualizarModelos(); atualizarBarra()">
        <option value="">Categoria do Carro</option>
        <option value="A">A - SUV</option>
        <option value="B">B - Populares</option>
        <option value="C">C - Compactos</option>
      </select>
      <select id="modelo" onchange="atualizarBarra()">
        <option value="">Selecione a Categoria</option>
      </select>
    </div>

    <div class="input-row"><!--Unidades Federativas do Brasil Inteiras-->
      <select id="uf" onchange="atualizarBarra()">
        <option value="">UF</option>
        <option>AC</option>
        <option>AL</option>
        <option>AP</option>
        <option>AM</option>
        <option>BA</option>
        <option>CE</option>
        <option>DF</option>
        <option>ES</option>
        <option>GO</option>
        <option>MA</option>
        <option>MT</option>
        <option>MS</option>
        <option>MG</option>
        <option>PA</option>
        <option>PB</option>
        <option>PR</option>
        <option>PE</option>
        <option>PI</option>
        <option>RJ</option>
        <option>RN</option>
        <option>RS</option>
        <option>RO</option>
        <option>RR</option>
        <option>SC</option>
        <option>SP</option>
        <option>SE</option>
        <option>TO</option>
      </select>
      <select id="acessorios" onchange="atualizarBarra()">
        <option value="">Acessorios Adcionais</option>
        <option>Carrinho de Criança</option>
        <option>GPS e Wi-Fi</option>
        <option>Viagem com Pets</option>
      </select>
    </div>
    <br>
    <div class="input-row">
      <label for="">Data de Retirada:</label>
      <input type="date" id="dataRetirada" onchange="atualizarBarra()" />
      <label for="">Data de Devolução:</label>
      <input type="date" id="dataDevolucao" onchange="atualizarBarra()" />
    </div>

    <br>
    <button onclick="cadastrar()" onchange="verificarBarra()">Cadastrar</button>
    <div id="resultado"></div>
    <ul id="listaClientes"></ul>
  </div>

  <br><br>
  <!--Parte de Login do Usuário Cadastrado-->
  <div class="container">
    <h2>Login Locadora</h2>
    <div class="input-group">
      <input type="text" id="cpfLogin" placeholder="CPF" onblur="formatarCPF(this)" maxlength="14" />
      <input type="text" id="placaLogin" placeholder="Placa do Veículo" onblur="formatarPlaca(this)" maxlength="7" />
    </div>
    <br />
    <button onclick="login()">Login</button>
    <div id="resultadoLogin"></div>
  </div>
  <!--Parte de Script JS e Verificações-->
  <script>
    function atualizarBarra() {
      const campos = [
        document.getElementById('nome').value.trim(),
        document.getElementById('cpf').value.trim(),
        document.getElementById('placa').value.trim(),
        document.getElementById('father').value.trim(),
        document.getElementById('mom').value.trim(),
        document.getElementById('cor').value.trim(),
        document.getElementById('categoria').value.trim(),
        document.getElementById('modelo').value.trim(),
        document.getElementById('uf').value.trim(),
        document.getElementById('dataRetirada').value.trim(),
        document.getElementById('dataDevolucao').value.trim()
      ];

      const total = campos.length;
      const preenchidos = campos.filter(campo => campo !== '').length;

      const barra = document.getElementById('barra');
      const percentual = (preenchidos / total) * 100;
      barra.style.width = percentual + '%';
    }
  </script>
  <script>
    // Array Dos Clientes 
    const clientes = [];

    // Modelos por categoria De carros sendo A,B,C
    const modelosPorCategoria = {
      A: ["Jeep Renegade", "Corolla Cross", "T-Cross", "Volvo XC60"],
      B: ["Gol", "Fiat Palio", "Siena", "Ford Ka"],
      C: ["Renault Kwid", "Fiat Mobi"]
    };

    // Atualiza lista de modelos conforme categoria selecionada 
    function atualizarModelos() {
      const categoria = document.getElementById("categoria").value;
      const modeloSelect = document.getElementById("modelo");
      modeloSelect.innerHTML = '<option value="">Selecione o Modelo</option>';
      if (modelosPorCategoria[categoria]) {
        modelosPorCategoria[categoria].forEach(modelo => {
          const option = document.createElement("option");
          option.value = modelo;
          option.textContent = modelo;
          modeloSelect.appendChild(option);
        });
      }
    }
    // Formata Nome sem utilizar números
    function formatarName(el) {
      const valor = el.value.trim();
      if (valor === '') {
        // vazio, pode deixar assim
        return;
      }
      // Verifica caractere a caractere se tem número
      for (let i = 0; i < valor.length; i++) {
        const char = valor[i];
        if (char >= '0' && char <= '9') {
          el.value = '';
          el.focus();
          return;
        }
      }
      // Verifica se tem ao menos uma letra (A-Z ou a-z)
      let temLetra = false;
      for (let i = 0; i < valor.length; i++) {
        const code = valor.charCodeAt(i);
        if ((code >= 65 && code <= 90) || (code >= 97 && code <= 122) || valor[i] === ' ') {
          temLetra = true;
          break;
        }
      }

      if (!temLetra) {
        alert('O nome deve conter pelo menos uma letra.');
        el.value = '';
        el.focus();
        return;
      }
      // Se passou, não faz nenhuma formatação, só remove espaços extras
      el.value = valor.replace(/\s+/g, ' '); // tirando espaços extras
    }
    // Formata CPF para padrão normal 000.000.000-00
    function formatarCPF(el) {
      let v = '';
      const numeros = '0123456789';
      for (let i = 0; i < el.value.length; i++) {
        if (numeros.indexOf(el.value[i]) !== -1) {
          v += el.value[i];
        }
      }
      if (v.length > 11) v = v.substring(0, 11);

      if (v.length >= 3) {
        v = v.substring(0, 3) + '.' + v.substring(3);
      }
      if (v.length >= 7) {
        v = v.substring(0, 7) + '.' + v.substring(7);
      }
      if (v.length >= 11) {
        v = v.substring(0, 11) + '-' + v.substring(11);
      }

      el.value = v;
    }

    // Formata placa no padrão ABC1234 (sem hífen, podendo ser somente 3 letras + 4 números)
    function formatarPlaca(el) {
      let v = '';
      const letras = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const numeros = '0123456789';
      const valor = el.value.toUpperCase();

      for (let i = 0; i < valor.length; i++) {
        const char = valor[i];
        if ((i < 3 && letras.indexOf(char) !== -1) || (i >= 3 && numeros.indexOf(char) !== -1)) {
          v += char;
        }
      }
      if (v.length > 7) v = v.substring(0, 7);

      el.value = v;
    }

    // Formata qualquer texto para remover espaços extras e colocar com a primeira letra maiúscula
    function formatarCampo(el) {
      let v = el.value.trim();
      v = v.replace(/\s+/g, ' ');
      el.value = v.charAt(0).toUpperCase() + v.slice(1);
    }

    // Validação simples dos campos (Declarados como o nome validarTexto na function)
    function validarTexto(id) {
      const el = document.getElementById(id);
      const val = el.value.trim();
      if (val.length < 3) {
        el.classList.add('erro');
        return null;
      }
      el.classList.remove('erro');
      el.classList.add('valido');
      return val;
    }

    function validarCPFsimples(id) {
      const el = document.getElementById(id);
      const val = el.value.replace(/\D/g, '');
      if (val.length !== 11) {
        el.classList.add('erro');
        return null;
      }
      el.classList.remove('erro');
      el.classList.add('valido');
      return val;
    }

    function validarPlacaSimples(id) {
      const el = document.getElementById(id);
      const val = el.value.toUpperCase();
      const padrao = /^[A-Z]{3}[0-9]{4}$/;
      if (!padrao.test(val)) {
        el.classList.add('erro');
        return null;
      }
      el.classList.remove('erro');
      el.classList.add('valido');
      return val;
    }

    function validarSelect(id) {
      const el = document.getElementById(id);
      if (!el.value) {
        el.classList.add('erro');
        return null;
      }
      el.classList.remove('erro');
      el.classList.add('valido');
      return el.value;
    }

    function validarData(id) {
      const el = document.getElementById(id);
      if (!el.value) {
        el.classList.add('erro');
        return null;
      }
      el.classList.remove('erro');
      el.classList.add('valido');
      return el.value;
    }

    function validarDatas(retirada, devolucao) {
      if (!retirada || !devolucao) return false;
      return new Date(devolucao) > new Date(retirada);
    }

    function limparEstilos() {
      document.querySelectorAll('input, select').forEach(el => {
        el.classList.remove('valido');
        el.classList.remove('erro');
      });
      document.getElementById('resultado').textContent = '';
      document.getElementById('resultadoLogin').textContent = '';
    }

    function atualizarBarra(preenchidos, total) {
      const barra = document.getElementById('barra');
      barra.style.width = ((preenchidos / total) * 100) + '%';
    }

    function limparCampos() {
      document.querySelectorAll('input, select').forEach(el => el.value = '');
      limparEstilos();
      atualizarBarra(0, 11);
    }

    // Módulo gerenciador de clientes 
    const ClienteManager = (function () {
      const todos = [];

      function adicionar(cliente) {
        todos.push(cliente);
      }

      function remover(cpf) {
        const index = todos.findIndex(c => c.cpf === cpf);
        if (index !== -1) todos.splice(index, 1);
      }

      function buscar(cpf, placa) {
        return todos.find(c => c.cpf === cpf && c.placa === placa);
      }

      function listarTodos() {
        return [...todos]; // retorna cópia do array
      }

      return {
        adicionar,
        remover,
        buscar,
        listarTodos
      };
    })();
    function atualizarBarra() {
      const campos = [
        'nome', 'cpf', 'placa', 'father', 'mom', 'cor', 'categoria',
        'modelo', 'uf', 'acessorios', 'dataRetirada', 'dataDevolucao'
      ];
      const total = campos.length;
      const preenchidos = campos.filter(id => document.getElementById(id).value.trim() !== '').length;
      document.getElementById('barra').style.width = (preenchidos / total * 100) + '%';
    }
    function cadastrar() {
      limparEstilos();

      const nome = validarTexto('nome');
      const cpf = validarCPFsimples('cpf');
      const placa = validarPlacaSimples('placa');
      const father = validarTexto('father');
      const mom = validarTexto('mom');
      const cor = validarSelect('cor');
      const categoria = validarSelect('categoria');
      const modelo = validarSelect('modelo');
      const uf = validarSelect('uf');
      const acessoriosAdds = validarSelect('acessorios');
      const dataRetirada = validarData('dataRetirada');
      const dataDevolucao = validarData('dataDevolucao');

      const camposValidos = [nome, cpf, placa, cor, categoria, modelo, uf, acessoriosAdds, dataRetirada, dataDevolucao].every(v => v !== null);
      if (!camposValidos) {
        document.getElementById('resultado').textContent = 'Por favor, preencha corretamente todos os campos.';
        return;
      }

      if (!validarDatas(dataRetirada, dataDevolucao)) {
        document.getElementById('resultado').textContent = 'Data de devolução deve ser após a data de retirada.';
        return;
      }

      if (ClienteManager.buscar(cpf, placa)) {
        document.getElementById('resultado').textContent = 'Este usuário já está cadastrado.';
        return;
      }

      const cliente = {
        nome, cpf, placa, father, mom, cor, categoria, modelo, uf, acessoriosAdds, dataRetirada, dataDevolucao
      };

      ClienteManager.adicionar(cliente);
      document.getElementById('resultado').textContent = 'Cadastro realizado com sucesso!';
      atualizarBarra(9, 11);
      listarClientes();
      limparCampos();
    }

    function listarClientes() {
      const ul = document.getElementById('listaClientes');
      ul.innerHTML = '';
      const todosClientes = ClienteManager.listarTodos();
      if (todosClientes.length === 0) {
        ul.textContent = 'Nenhum cliente cadastrado.';
        return;
      }
      todosClientes.forEach(c => {
        const li = document.createElement('li');
        li.textContent = `${c.nome} - CPF: ${c.cpf} - Placa: ${c.placa}`;
        const btn = document.createElement('button');
        btn.textContent = 'Remover';
        btn.onclick = () => {
          ClienteManager.remover(c.cpf);
          listarClientes();
        };
        li.appendChild(btn);
        ul.appendChild(li);
      });
    }

    function login() {
      limparEstilos();
      const cpfLogin = validarCPFsimples('cpfLogin');
      const placaLogin = validarPlacaSimples('placaLogin');

      if (!cpfLogin || !placaLogin) {
        document.getElementById('resultadoLogin').textContent = 'CPF e Placa inválidos para login.';
        return;
      }

      const cliente = ClienteManager.buscar(cpfLogin, placaLogin);
      if (!cliente) {
        document.getElementById('resultadoLogin').textContent = 'Usuário não encontrado.';
        return;
      }

      document.getElementById('resultadoLogin').textContent = 'Login efetuado! Redirecionando...';

      // Passa dados para a página imagens.html via sessionStorage
      sessionStorage.setItem('clienteLogado', JSON.stringify(cliente));
      setTimeout(() => {
        window.location.href = 'dadoscliente.html';
      }, 1000);
    }
  </script>


</body>

</html>